---
title: "DESCO - Knowledge Discovery"
author: "1141074 - S???rgio Silva | 1040706 - S???rgio Castro | 1970400 - Pedro Neves"

date: "5/3/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The	project	must	follow	the	CRISP-DM	methodology	[3]	and	have	R	scripts	adequate	to	each	of	its	phases:
??? data	exploration	and	preparation;

Carregamento da tabela BRAND.dat
```{r data Loading}
brand <- read.table("DATA-CRM/BRAND.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela brand, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(brand)
dim(brand)
str(brand)

```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(brand))
unique(brand)
```


Carregamento da tabela CAMPAIGN.dat
```{r}
campaign <- read.table("DATA-CRM/CAMPAIGN.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela campaign, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(campaign)
dim(campaign)
str(campaign)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(campaign))
unique(campaign)
```



Carregamento da tabela CARD.dat
```{r}
card <- read.table("DATA-CRM/CARD.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela card, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(card)
dim(card)
str(card)
nrow(card[!complete.cases(card),])
```
??? preciso tratar os dados nulos e errados nas colunas NumChildren e YoungestChild , pois tem n???meros negativos. No MaritialStatus a dados nulos que devem ser tratados tamb???m.

```{r}
card[card<0]<-0


```

Verificar se a tabela possui dados nulos
```{r}
table(is.na(card))
unique(card)
```



Carregamento da tabela CATEGORY.dat
```{r}
category <- read.table("DATA-CRM/CATEGORY.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela category, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(category)
dim(category)
str(category)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(category))
```


Carregamento da tabela SUBCATEGORY.dat
```{r}
subcategory <- read.table("DATA-CRM/SUBCATEGORY.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela subcategory, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(subcategory)
dim(subcategory)
str(subcategory)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(subcategory))
```




Carregamento da tabela ITEM.dat
```{r}
item <- read.table("DATA-CRM/ITEM.dat",header = TRUE,sep = ";")
```
Verifica??????o dos dados da tabela item, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(item)
dim(item)
str(item)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(item))
```


Carregamento da tabela TRANSACTION.dat
```{r}
library(dplyr)
transaction <- read.table("DATA-CRM/TRANSACTION.dat",header = TRUE,sep = ",")
trs_opt <- transaction[,c(2,4,5)]
setDT(trs_opt)
transaction_item <- read.table("DATA-CRM/TRANSACTION_ITEM.dat",header = TRUE,sep = ",")
trs_item_opt <- transaction_item[,c(4,7)]
setDT(trs_item_opt)

dplr <- left_join(trs_opt,trs_item_opt, by="TransactionID")

trd <- merge(trs_opt,trs_item_opt,by = "TransactionID")
df_transaction <- as.data.frame(transaction)
```
Verifica??????o dos dados da tabela transaction, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(transaction)
dim(transaction)
str(transaction)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(transaction))
```


Carregamento da tabela TRANSACTION_ITEM.dat
```{r}
transactionitem <- read.table("DATA-CRM/TRANSACTION_ITEM.dat",header = TRUE,sep = ",",dec = ",")
```
Verifica??????o dos dados da tabela transactionitem, tal como o n???mero de colunas e linhas, bem como se os dados foram corretamente carregados.

```{r}
summary(transactionitem)
dim(transactionitem)
str(transactionitem)
```
Verificar se a tabela possui dados nulos
```{r}
table(is.na(transactionitem))
```


Building the RFM (recency, frequency and monetary) model.

Recency
````{r}
library(rfm)
analysis_date <- as.Date(Sys.Date())
df_transaction[,2] <- as.Date(as.character.Date(df_transaction[,2]),"%Y%m%d")
rfm_result <- rfm_table_order(df_transaction,df_transaction$CardID,df_transaction$Date)


```

Frequency
````{r}
library(data.table)
df_transaction = data.table(df_transaction)

df_transaction[, `freq-loc` := .N, by = transaction$CardID]


```



```{r}
# Merging the data sets

#card_data <- merge(card,campaign, by.x = ("CardID"), by.y = ("CardID"))
#item_data <- merge(item,category,by.x = ("CategoryCode"), by.y = ("CategoryCode"))
#item_data <- merge(item_data,subcategory,by.x = ("SubCategoryCode"), by.y = ("SubCategoryCode"))
#transaction_item_data <- merge(transactionitem,item_data,by.x = ("ItemCode"), by.y = ("ItemCode"))
#transaction_data <- merge(transaction,transaction_item_data,item_data,by.x = ("TransactionID"), by.y = ("TransactionID"))
```

```{r}
barplot(table(cust_info_calls$AgeGrp),ylim=c(0,25000),main="Age", col=c(1,2,3))

```



??? data	pre-processing;
??? creation	of	models	using	some	data	mining	algorithms	studied;
??? evaluation	of	the	models	created.
The	models	created	should	provide:
??? better	knowledge	of	customer	groups profile;
??? indication	of	the	most	appropriate	products	for	each	customer	group;
??? forecast	responses	to	future	campaigns
